# skill.yaml - Testaroli AI Skill Metadata
# This file helps AI assistants discover and use testaroli capabilities

skill:
  name: "Overriding Go Functions in Unit Tests"
  description: "Mock and override Go functions, methods, and standard library calls using testaroli library for comprehensive unit testing"
  language: "go"
  category: "testing"
  version: "1.0.0"
  
  tags:
    - testing
    - mocking
    - unit-tests
    - go
    - monkey-patching
    - test-automation
    - function-override
    - method-mocking
  
  documentation:
    skills: "SKILLS.md"
    architecture: "AGENTS.md"
    main: "docs/README.md"
    examples: "examples/"
    api_reference: "https://pkg.go.dev/github.com/qrdl/testaroli"
  
  patterns:
    - name: "Simple Function Override"
      description: "Override a package function with mock implementation"
      file: "SKILLS.md"
      section: "Pattern 1"
      use_case: "Basic function mocking with expectation tracking"
    
    - name: "Function with Argument Validation"
      description: "Override function and validate arguments"
      file: "SKILLS.md"
      section: "Pattern 2"
      use_case: "Ensure function receives expected parameters"
    
    - name: "Method Override"
      description: "Override methods with receiver as first argument"
      file: "SKILLS.md"
      section: "Pattern 3"
      use_case: "Mock object methods for testing"
    
    - name: "Standard Library Override"
      description: "Override functions from Go standard library"
      file: "SKILLS.md"
      section: "Pattern 4"
      use_case: "Mock file I/O, network operations, system calls"
    
    - name: "Error Simulation"
      description: "Simulate error conditions for testing"
      file: "SKILLS.md"
      section: "Pattern 5"
      use_case: "Test error handling and recovery logic"
    
    - name: "Override Chain"
      description: "Create sequence of different return values"
      file: "SKILLS.md"
      section: "Pattern 6"
      use_case: "Test code with multiple calls to same function"
    
    - name: "Multiple Times Override"
      description: "Override applies for N consecutive calls"
      file: "SKILLS.md"
      section: "Pattern 7"
      use_case: "Mock function for fixed number of calls"
    
    - name: "Unlimited Override"
      description: "Override active for entire test duration"
      file: "SKILLS.md"
      section: "Pattern 8"
      use_case: "Mock function for all calls in test"
    
    - name: "Always Override"
      description: "Permanent override outside call chain"
      file: "SKILLS.md"
      section: "Pattern 9"
      use_case: "Global mock not participating in chain"
    
    - name: "Variadic Function Override"
      description: "Override functions with variadic parameters"
      file: "SKILLS.md"
      section: "Pattern 10"
      use_case: "Mock functions like fmt.Sprintf, logging, or custom variadic functions"
    
    - name: "Variadic Method Override"
      description: "Override methods with variadic parameters"
      file: "SKILLS.md"
      section: "Pattern 11"
      use_case: "Mock logging methods or other variadic methods"
    
    - name: "Passing Data via Context"
      description: "Use context.WithValue to pass test data to mocks"
      file: "SKILLS.md"
      section: "Pattern 12"
      use_case: "When mock needs access to outer variables or test configuration"
    
    - name: "Generic Function Override"
      description: "Override instantiated generic functions via reference"
      file: "SKILLS.md"
      section: "Pattern 13"
      use_case: "Mock generic utility functions with type parameters"
    
    - name: "Interface Implementation Override"
      description: "Override concrete type methods that implement interfaces"
      file: "SKILLS.md"
      section: "Pattern 14"
      use_case: "Mock interface implementations without interface-level override"
  
  capabilities:
    - "Override package functions"
    - "Override methods (instance and pointer receivers)"
    - "Override standard library functions"
    - "Override variadic functions and methods"
    - "Override generic functions (via reference)"
    - "Override concrete implementations of interfaces"
    - "Chain multiple overrides in sequence"
    - "Validate function call arguments"
    - "Track expectation fulfillment"
    - "Simulate error conditions"
    - "Control number of override applications"
    - "Capture and verify call patterns"
    - "Pass data to mocks via context"
    - "Cross-package mocking"
  
  requirements:
    compiler_flags:
      - "-gcflags=all=-N -l"
    reason: "Disables optimizations and inlining for runtime patching"
    
    platforms:
      os: ["linux", "macos", "windows", "freebsd", "netbsd", "openbsd", "dragonfly"]
      arch: ["amd64", "arm64"]
    
    go_version: "1.24.0+"
  
  limitations:
    - "Generic functions have limited support (call via reference only)"
    - "Cannot override inlined functions"
    - "Platform-dependent (OS and architecture specific)"
    - "Testing only - never use in production"
    - "Requires specific compiler flags"
  
  related_documentation:
    generics: "docs/generics.md"
    interfaces: "docs/interfaces.md"
    macos_notes: "docs/macOS.md"
  
  repository:
    url: "https://github.com/qrdl/testaroli"
    license: "Apache License 2.0"
  
  ai_usage:
    instruction: "When generating testaroli overrides, reference SKILLS.md for patterns and AGENTS.md for architecture understanding"
    quick_start: "Override(TestingContext(t), targetFunc, Once, mockFunc)()"
    key_functions:
      - "Override() - Create function/method override"
      - "Expectation() - REQUIRED call inside every mock to track execution and manage chain"
      - "CheckArgs() - Validate arguments"
      - "ExpectationsWereMet() - Verify all mocks called"
      - "Reset()/ResetAll() - Manual override cleanup"
    
    critical_requirements:
      - "ALWAYS call Expectation() inside every mock function (even if not checking args)"
      - "Use TestingContext(t) not context.Background()"
      - "Call ExpectationsWereMet() at end of test"
      - "Use -gcflags='all=-N -l' compiler flags"
      - "Method receiver becomes first argument in mock"
    
    common_mistakes:
      - "Forgetting to call Expectation() - causes chain to break and ExpectationsWereMet() to fail"
      - "Using wrong variadic syntax - pass as slice in CheckArgs, individual args in trailing call"
      - "Trying to override interface methods - must override concrete type method"
      - "Accessing outer variables from mock - use context.WithValue instead"
